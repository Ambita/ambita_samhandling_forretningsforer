<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {%- include head.html -%}
  <style>
    /* Import Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=PT+Serif:wght@400;700&display=swap');
    
    /* Ambita Design Tokens */
    :root {
      /* Colors - Primary */
      --ambita-purple-600: #0d0a27;
      --ambita-purple-500: #381c4d;
      --ambita-purple-400: #ad83cc;
      --ambita-purple-300: #deb9f9;
      --ambita-purple-200: #e9d7ff;
      --ambita-purple-100: #f3edf7;
      
      /* Colors - Neutral */
      --ambita-white: #ffffff;
      --ambita-grey-400: #555555;
      --ambita-grey-200: #e1e1e1;
      --ambita-grey-100: #f5f5f5;
      
      /* Colors - Peach */
      --ambita-peach-300: #f8c087;
      --ambita-peach-200: #ffe9d0;
      --ambita-peach-100: #fff4e7;
      
      /* Typography */
      --font-family-title: 'Inter', sans-serif;
      --font-family-display: 'PT Serif', serif;
      --font-family-body: 'Inter', sans-serif;
      
      /* Spacing */
      --spacing-l: 20px;
      --spacing-xl: 25px;
      --spacing-2xl: 30px;
      
      /* Border Radius */
      --border-radius-m: 10px;
      --border-radius-l: 20px;
    }
    
    /* Global Typography */
    body {
      font-family: var(--font-family-body);
      color: var(--ambita-purple-600);
    }
    
    /* Header Styling */
    .site-title {
      font-family: var(--font-family-display) !important;
      color: var(--ambita-purple-600) !important;
      font-weight: 700;
      text-decoration: none;
    }
    
    .site-title:hover {
      color: var(--ambita-purple-500) !important;
    }
    
    /* Header Layout - ensure consistent positioning */
    .site-header .wrapper {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-left: auto;
    }

    .language-toggle {
      display: inline-flex;
      align-items: center;
      border: 1px solid var(--ambita-purple-300);
      background: var(--ambita-white);
      border-radius: var(--border-radius-m);
      overflow: hidden;
    }

    .language-toggle button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      background: transparent;
      border: none;
      font-family: var(--font-family-body);
      font-size: 16px;
      color: var(--ambita-purple-500);
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .language-toggle button[aria-pressed="true"] {
      background: var(--ambita-purple-500);
      color: var(--ambita-purple-100);
    }

    .language-toggle button:focus-visible {
      outline: 2px solid var(--ambita-purple-500);
      outline-offset: -2px;
    }

    .language-toggle button + button {
      border-left: 1px solid var(--ambita-purple-300);
    }

    .lang-en-inline,
    .lang-no-inline {
      display: inline;
    }

    body[data-lang="no"] .lang-en-inline {
      display: none !important;
    }

    body[data-lang="en"] .lang-no-inline {
      display: none !important;
    }

    .layout-width-toggle {
      border: 1px solid var(--ambita-purple-300);
      background: var(--ambita-white);
      color: var(--ambita-purple-500);
      border-radius: var(--border-radius-m);
      padding: 6px 14px;
      font-family: var(--font-family-body);
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }

    .layout-width-toggle:hover {
      background-color: var(--ambita-purple-200);
      color: var(--ambita-purple-600);
      border-color: var(--ambita-purple-400);
    }

    .layout-width-toggle:focus {
      outline: 2px solid var(--ambita-purple-500);
      outline-offset: 2px;
    }

    /* Layout Width */
    .wrapper {
      max-width: 1400px !important;
    }

    body.full-width .wrapper {
      max-width: none !important;
      width: calc(100% - 2rem); /* Leave space for button and padding */
      padding-right: 1rem;
      padding-left: 1rem;
    }
    
    /* Ensure header wrapper also respects viewport bounds */
    body.full-width .site-header .wrapper {
      width: calc(100% - 2rem);
      padding-right: 1rem;
      padding-left: 1rem;
    }

    .language-content {
      display: block;
    }

    body[data-lang="no"] .lang-en {
      display: none !important;
    }

    body[data-lang="en"] .lang-no {
      display: none !important;
    }
  </style>

  <body data-lang="{{ page.lang | default: site.lang | default: 'en' }}">

    {%- include header.html -%}

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    {%- include footer.html -%}

    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.11.0/dist/mermaid.min.js"></script>
    <script>
      (function () {
        if (!window.mermaid) {
          return;
        }

        window.mermaid.initialize({
          startOnLoad: false,
          theme: 'neutral'
        });

        function collectNodes(language) {
          var selector = language === 'no'
            ? '.language-content.lang-no .mermaid'
            : '.language-content.lang-en .mermaid';
          var all = document.querySelectorAll(selector);
          return Array.prototype.filter.call(all, function (node) {
            return node.getAttribute('data-mermaid-rendered') !== 'true';
          });
        }

        function prepareNodes(nodes) {
          nodes.forEach(function (node) {
            var source = node.getAttribute('data-mermaid-source');
            if (!source) {
              source = node.innerHTML.trim();
              node.setAttribute('data-mermaid-source', source);
            }
            node.innerHTML = source;
            node.removeAttribute('data-processed');
            node.removeAttribute('data-mermaid-id');
            node.removeAttribute('data-chart-id');
            node.removeAttribute('aria-describedby');
            node.removeAttribute('role');
            node.setAttribute('data-mermaid-rendered', 'false');
          });
        }

        function renderFor(language) {
          var lang = language === 'no' ? 'no' : 'en';
          var nodes = collectNodes(lang);
          if (!nodes.length) {
            return;
          }

          prepareNodes(nodes);

          try {
            window.mermaid.init(undefined, nodes);
            nodes.forEach(function (node) {
              node.setAttribute('data-mermaid-rendered', 'true');
            });
          } catch (error) {
            console.error('Mermaid render error', error);
          }
        }

        window.renderMermaidForLanguage = function (language) {
          renderFor(language);

          var otherLanguage = language === 'no' ? 'en' : 'no';
          var selector = otherLanguage === 'no'
            ? '.language-content.lang-no .mermaid'
            : '.language-content.lang-en .mermaid';
          document.querySelectorAll(selector).forEach(function (node) {
            node.setAttribute('data-mermaid-rendered', 'false');
          });
        };

        var initialLanguage = document.body.getAttribute('data-lang') === 'no' ? 'no' : 'en';
        renderFor(initialLanguage);
      })();
    </script>

  </body>

</html>
